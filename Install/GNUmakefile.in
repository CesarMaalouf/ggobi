# This is placed in the top-level directory
# of the ggobi suite and is a convenience
# for 

TOP=@TOP@
INSTALL_DIR=@INSTALL_DIR@

XML_UTILS=@XML_UTILS@

UTILS=$(XML_UTILS:%=bin/%)
PLUGIN_DIRS=@PLUGIN_DIRS@

CUR_DIR=$(shell pwd)

all: lib/libgtkext.so bin/ggobi.bin @EMBED@ $(UTILS) @PACKAGES@ Plugins

.PHONY:	lib Rggobi Pythonggobi Perlggobi

lib/libgtkext.so:
	$(MAKE) -C gtkext/src install

ggobi bin/ggobi.bin: lib/libgtkext.so 
	$(MAKE) -C src ../bin/ggobi.bin

lib/libggobi.so lib: lib/libgtkext.so 
	$(MAKE) -C src ../lib/libggobi.so


bin/xmlConvert:
	$(MAKE) -C src ../bin/xmlConvert

# Should use install command.
install:
	cp bin/xmlConvert  bin/ggobi bin/ggobi.bin $(INSTALL_DIR)/bin
	cp lib/libggobi.so $(INSTALL_DIR)/lib

Rggobi: lib/libggobi.so
	(GGOBI_ROOT=`pwd` ; export GGOBI_ROOT ; @R_BIN@ INSTALL -c @R_PKG_DIR@ $@)


Plugins:  @EMBED_LIB@
	if test -n "${PLUGIN_DIRS}" ; then \
	  for f in $(PLUGIN_DIRS) ; do \
	    echo "Building plugin $$f" ; \
	    $(MAKE) -C plugins/$$f GGOBI_CONFIG=$(CUR_DIR)/bin/ggobi-config ; \
	  done \
	fi 

clean:
	for f in src gtkext/src ; do \
	  $(MAKE) -C $$f clean ; \
	done

distclean: clean
	-rm config.cache config.log
	-rm lib/*.so
	-rm bin/ggobi.bin bin/xmlConvert

# other scripts generated by autoconf
