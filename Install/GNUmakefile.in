# This is placed in the top-level directory
# of the ggobi suite and is a convenience
# for 

TOP=@TOP@
INSTALL_DIR=@INSTALL_DIR@

XML_UTILS=@XML_UTILS@

UTILS=$(XML_UTILS:%=bin/%)
PLUGIN_DIRS=@PLUGIN_DIRS@

CUR_DIR=$(shell pwd)

include Makeconf

GTK_EXT=lib/libgtkext.so

all: $(GTK_EXT) bin/ggobi.bin @EMBED@ $(UTILS) @PACKAGES@ Plugins

.PHONY:	lib Rggobi Pythonggobi Perlggobi

lib/libgtkext.so:
	$(MAKE) -C gtkext/src install

ggobi bin/ggobi.bin: $(GTK_EXT)
	$(MAKE) -C src ../bin/ggobi.bin

lib/libggobi.so lib: $(GTK_EXT)
	$(MAKE) -C src ../lib/libggobi.so


bin/xmlConvert:
	$(MAKE) -C src ../bin/xmlConvert

# Should use install command.
install:
	echo "Installation into a system directory is not implemented yet"

	#cp bin/xmlConvert  bin/ggobi bin/ggobi.bin $(INSTALL_DIR)/bin
	#cp lib/libggobi.so $(INSTALL_DIR)/lib

Rggobi: @EMBED_LIB@
	(GGOBI_ROOT=`pwd` ; export GGOBI_ROOT ; @R_BIN@ INSTALL -c @R_PKG_DIR@ $@)

Python: @EMBED_LIB@
	@if test -d Python ; then \
	   $(MAKE) -C Python ; \
	else \
	   echo "The python module is not present. Download it and reconfigure."
	fi


ifneq (${PLUGIN_DIRS},)
Plugins:  @EMBED_LIB@
	if test -n "${PLUGIN_DIRS}" ; then \
	  for f in $(PLUGIN_DIRS) ; do \
	    echo "Building plugin $$f" ; \
	      ./share/tools/plugin $$f ; \
	  done \
	fi 
else
Plugins:
	@echo "No ggobi plugins configured for building"
endif

clean:
	for f in src gtkext/src ; do \
	  $(MAKE) -C $$f clean ; \
	done

distclean: clean
	-rm config.cache config.log
	-rm lib/*.so
	-rm bin/ggobi.bin bin/xmlConvert

# other scripts generated by autoconf
