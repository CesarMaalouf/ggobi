This document attempts to explain how to build GGobi for Windows.  It
is intended for pepole working from the CVS repository (either
directly or via rsync).  It is not for use with the standard source
distribution!


<h2>Cygwin</h2> The tools we use to build the GGobi distribution are
based on having the <a href="http://www.cygwin.com">Cygnus tools</a>
installed.  This is a relatively painless installation: go to the web
site and click on the "<i>Install Now</i>" icon near the top of the
page.  It is important to ensure that you have the necessary
development tools such as GNU make.  There are options within the
installation that allow you to customize which packages are installed
and this can be done after the initial installation.

<h2>Gcc versions</h2>
The Gtk, Glib, etc. libraries from Tor Lillqvist must be used with gcc
2.95 or Visual C++.  It appears that you cannot use gcc 3.*.  This is
indicated by a run-time error which states that the definition of
GtkWindow is different (between the header files and the run-time
engine) and that one probably needs to re-compiled using the
-fnative-struct argument.  Gcc 3.* doesn't support that argument.
Using gcc 2.95 works fine for me. Just specify the explicit location
of the GCC compiler by giving its value in the definition of the CC
make variable (either in local.config or Makefile.win)


<h2>Downloading the 3<sup>rd</sup>-party libraries</h2> There are
several libraries on which GGobi depends that we need to download
before building.  It is significantly simpler to fetch the binary
versions of these and to unzip them from within the same directory.
If you do this, you need only specify the location of this directory.
The following is a simple way to do things(at the cost of some
flexibility which interested users can regain by understanding the
Makefile.win32 file).
<ol>
 <li>
   Fetch the binaries listed below from the links
provided.
  <li>
   Then, create a new directory, say 
    c:\\GGobiLibs, which we will also assume
  is accessible  as /cygdrive/c/GGobiLibs
  in the cygwin terminology.
  <li>
    Change to this new directory
<pre>
    cd /cygdrive/c/GGobiLibs
</pre>
   <li>
     Unzip the different .zip files you downloaded
<pre>
 unzip libxml2-2.4.28.win32.zip
 unzip libintl-0.10.40-tml-20020904.zip
 unzip libiconv-1.8-w3-1.bin.zip
 unzip gtk+-1.3.0-20020922.zip
 unzip gtk+-dev-1.3.0-20020912.zip
 unzip glib-2.0.6-20020802.zip
 unzip glib-dev-2.0.6-20020802.zip
</pre>

 <li>
   Copy the local.config-win32 file to local.config
 <li>
  Edit local.config and set the value of 
  <b>DOWNLOAD_DIR</b> to the location
  <code>/cygdrive/c/GGobiLibs</code>
  (or wherever you created the directory)

 <li>
  If necessary, edit the names of the iconv
  and libxml directories which may change as different versions
  become available.

 <li> You are ready to build GGobi.
</ol>



<h3>libxml2</h3>
Get libxml2 from 
<a href="http://www.fh-frankfurt.de/~igor/projects/libxml/index.html">
http://www.fh-frankfurt.de/~igor/projects/libxml/index.html
</a>


<h3>Other libraries: Gtk, glib, iconv, intl</h3>

Get the Gtk, glib, iconv, libintl development <i>and</i>
run-time libraries from
<a href="http://www.gimp.org/~tml/gimp/win32/downloads.html">
http://www.gimp.org/~tml/gimp/win32/downloads.html
</a>
All of these components 
are accessible directly or indirectly through
that page.

<dl>
 <dd>libiconv
 <dt> This is 
    housed at 
   <a href="http://sourceforge.net/project/showfiles.php?group_id=25167">
    sourceforge</a>.
    We are using version 1.8, as in
     <code>libiconv-1.8-w32-1.bin.zip</code>
  <dd> libintl
   <dt>
    Download libintl-0.10.40-tml-20020904.zip.

  <dd> glib
  <dt>
   You need both the run-time and the developer's packages
   glib-2.0.6

   <dd> gtk+
   <dt>
     gtk+-1.3.0-20020922.zip 
</dl>

You don't need gettext.

<h2>Inno Installer</h2>
To create the self-installing GGobi executable, you will need to
download Inno from 
<a href="http://www.jrsoftware.org/">http://www.jrsoftware.org/</a>

<h2>My versions</h2>

<table>
<tr>
 <th>libiconv</th><th>liboconv-1.8 (w32-1)</th>
</tr>
<tr>
 <th>libint</th><th>glib-0.10.40,  2002/09/04</th>
</tr>
<tr>
 <th>glib</th><th>glib-2.0.6,  2002/08/02</th>
</tr>
<tr>
<th>gtk+</th><th>gtk+-1.3.0 (2002/09/22) </th>
</tr>

</table>

<h2>Compiling</h2>

To compile GGobi, run <code>make</code> in the GGobi directory. But be
certain to specify the Makefile.win32 file:

<pre>
 make -f Makefile.win32
</pre>

Hopefully, all will go well and you will end up with a ggobi.exe.


<h2>Run-time Paths</h2>
You need to add the different directories containing
the necessary DLLs to your PATH.

export PATH=$PATH:${DOWNLOAD_DIR}/lib:$${LIB_XML}/lib:${LIB_ICONV}


<h2>Building the Self-installing Executable</h2>

As mentioned, you will need the INNO Setup tool on your machine.  Then
you will need to prepare the files that will be put into the
installer.  The make target <i>installer</i> takes care of this for
you.
<pre>
 make -f Makefile.win32 installer
</pre>
This builds pretty much everything that goes into the installer:
ggobi.exe, libggobi.dll, libggobi.a,

<p/>
Then finally, you can build the installer by starting the INNO
tool, loading Install/ggobi.iss and selecting the Compile menu item.
The resulting installer is placed in the directory
<code>Install/Output/</code> and named <b>setup.exe</b>.


<h3>What does <i>make -f Makefile.win32 installer</i> do?</h3>
Just for the record, what the <i>installer</i> target does
is as follows.

We create the input file for INNO.
You do this via the command 
<pre>
 make -f Makefile.win32 Install/ggobi.iss
</pre>
This copies the ggobi.iss.in file in the Install/ directory to
Install/ggobi.iss and then replaces the string @GGOBI_HOME@ with the
current directory.  It also replaces the name of the directory
expected to contain the libraries (i.e. the DLLs) that will be shipped
with GGobi, including the 3<sup>rd</sup>-party ones you downloaded
previously.  

<p/>
These libraries are placed into the libs/ directory within
the current working directory.  The next step is to create this
directory and copy the libraries there so they can be put in the
installer's executable.  
This step is  done via
the command
<pre>
 make -f Makefile.win32 libs
</pre>

</p>
And finally <i>installer</i> creates libggobi.a and libggobi.dll.





